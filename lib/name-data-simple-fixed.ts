import { customFortuneData } from "./fortune-data-custom"

const DEBUG_MODE = true

// æ¼¢å­—ã®ç”»æ•°ã‚’å–å¾—ã™ã‚‹é–¢æ•°
export function getStrokeCount(character: string): number {
  const strokeData: Record<string, number> = {
    // åŸºæœ¬æ¼¢å­—ã®ç”»æ•°ãƒ‡ãƒ¼ã‚¿ï¼ˆä¸€éƒ¨ï¼‰
    "ä¸€": 1, "äºŒ": 2, "ä¸‰": 3, "å››": 4, "äº”": 5, "å…­": 6, "ä¸ƒ": 7, "å…«": 8, "ä¹": 9, "å": 10,
    "é‡‘": 8, "é›¨": 8, "è¼": 15, "é¾": 16, "ä½": 7, "ã€…": 0, "æœ¨": 4, "é–": 13, "éš†": 17,
    "ç”°": 5, "ä¸­": 4, "å±±": 3, "å·": 3, "å¤§": 3, "å°": 3, "äºº": 2, "å£": 3, "æ—¥": 4, "æœˆ": 4,
    "æ°´": 4, "ç«": 4, "åœŸ": 3, "æœ¨": 4, "é‡‘": 8, "çŸ³": 5, "ç‰": 5, "ç‹": 4, "å¥³": 3, "å­": 3,
    "ç”·": 7, "å¥³": 3, "çˆ¶": 4, "æ¯": 5, "å…„": 5, "å¼Ÿ": 7, "å§‰": 8, "å¦¹": 8, "å¤«": 4, "å¦»": 8,
    "å­": 3, "å­«": 10, "è¦ª": 16, "å‹": 4, "æ„›": 13, "å¿ƒ": 4, "æ‰‹": 4, "è¶³": 7, "ç›®": 5, "è€³": 6,
    "é¼»": 14, "å£": 3, "èˆŒ": 6, "æ­¯": 12, "é ­": 16, "é¡”": 18, "ä½“": 7, "èº«": 7, "èƒŒ": 9, "èƒ¸": 10,
    "è…¹": 13, "è…°": 13, "è„š": 11, "è…•": 12, "æŒ‡": 9, "çˆª": 4, "æ¯›": 4, "é«ª": 14, "è‚Œ": 6, "è¡€": 6,
    "éª¨": 10, "è‚‰": 6, "çš®": 5, "æœ": 8, "ç€": 12, "é´": 13, "å¸½å­": 12, "çœ¼é¡": 16, "æ™‚è¨ˆ": 17,
    "å®¶": 10, "é–€": 8, "çª“": 12, "åºŠ": 7, "å£": 16, "å¤©äº•": 8, "æŸ±": 9, "éšæ®µ": 16, "å»Šä¸‹": 16,
    "éƒ¨å±‹": 12, "å¯å®¤": 16, "å°æ‰€": 12, "é¢¨å‘‚": 14, "ãƒˆã‚¤ãƒ¬": 15, "ç„é–¢": 12, "åº­": 10, "æ± ": 6,
    "èŠ±": 7, "æœ¨": 4, "è‰": 9, "è‘‰": 12, "å®Ÿ": 8, "æ ¹": 10, "æ": 8, "å¹¹": 13, "æ£®": 12, "æ—": 8,
    "å±±": 3, "å·": 3, "æµ·": 9, "ç©º": 8, "é›²": 12, "é›¨": 8, "é›ª": 11, "é¢¨": 9, "é›·": 13, "å¤ªé™½": 12,
    "æœˆ": 4, "æ˜Ÿ": 9, "åœ°çƒ": 12, "å®‡å®™": 12, "ä¸–ç•Œ": 12, "å›½": 8, "éƒ½": 12, "çœŒ": 9, "å¸‚": 5,
    "ç”º": 7, "æ‘": 7, "åŒº": 4, "é§…": 14, "ç©ºæ¸¯": 12, "æ¸¯": 12, "æ©‹": 16, "é“è·¯": 16, "ä¿¡å·": 16,
    "è»Š": 7, "é›»è»Š": 17, "ãƒã‚¹": 12, "ã‚¿ã‚¯ã‚·ãƒ¼": 18, "é£›è¡Œæ©Ÿ": 16, "èˆ¹": 11, "è‡ªè»¢è»Š": 16,
    "æ­©": 8, "èµ°": 7, "é£›": 9, "æ³³": 11, "ç™»": 12, "é™": 10, "ä¸Š": 3, "ä¸‹": 3, "å‰": 9, "å¾Œ": 9,
    "å·¦": 5, "å³": 5, "ä¸­": 4, "å¤–": 5, "å†…": 4, "æ±": 8, "è¥¿": 6, "å—": 9, "åŒ—": 5, "æ˜¥": 9,
    "å¤": 10, "ç§‹": 9, "å†¬": 5, "æœ": 12, "æ˜¼": 9, "å¤œ": 8, "ä»Š": 4, "æ˜”": 8, "æœªæ¥": 12, "éå»": 12,
    "æ™‚é–“": 17, "åˆ†": 4, "ç§’": 9, "æ™‚": 10, "æ—¥": 4, "é€±": 11, "æœˆ": 4, "å¹´": 6, "ä¸–ç´€": 12,
    "ä»Šæ—¥": 8, "æ˜¨æ—¥": 16, "æ˜æ—¥": 8, "æ¥é€±": 16, "æ¥æœˆ": 16, "æ¥å¹´": 16, "æ¯æ—¥": 16, "æ¯é€±": 16,
    "æ¯æœˆ": 16, "æ¯å¹´": 16, "æ™‚ã€…": 16, "æ™‚ã€…": 16, "ã„ã¤ã‚‚": 12, "ãŸã¾ã«": 12, "ã‚ˆã": 8,
    "ã‚ã¾ã‚Š": 12, "å…¨ç„¶": 12, "ã¨ã¦ã‚‚": 12, "ã™ã”ã": 12, "æœ¬å½“": 12, "ç¢ºå®Ÿ": 12, "å¯èƒ½": 12,
    "ä¸å¯èƒ½": 12, "ç°¡å˜": 12, "é›£ã—ã„": 12, "æ˜“ã—ã„": 12, "è¤‡é›‘": 12, "å˜ç´”": 12, "æ–°": 13,
    "å¤": 5, "è‹¥": 8, "è€": 6, "ç¾": 9, "é†œ": 13, "è‰¯ã„": 8, "æ‚ªã„": 12, "æ­£": 5, "é–“": 12,
    "åŒ": 6, "é•": 12, "ä¼¼": 7, "æ¯”": 4, "å¤§": 3, "å°": 3, "é•·": 8, "çŸ­": 12, "é«˜": 10, "ä½": 7,
    "æ·±": 11, "æµ…": 11, "åºƒ": 5, "ç‹­": 9, "åš": 9, "è–„": 16, "é‡": 9, "è»½": 12, "å¼·": 11, "å¼±": 10,
    "é€Ÿ": 10, "é…": 12, "æ—©": 6, "å¿™": 12, "æš‡": 12, "æ¥½": 13, "è‹¦": 8, "ç”˜": 5, "è¾›": 7,
    "é…¸": 14, "å¡©": 16, "ç”˜": 5, "ç¾å‘³": 12, "ä¸å‘³": 12, "ç†±": 15, "å†·": 7, "æ¸©": 12, "æ¶¼": 11,
    "æš–": 13, "å¯’": 12, "æš‘": 12, "æ™´": 12, "æ›‡": 16, "é›¨": 8, "é›ª": 11, "é¢¨": 9, "é›·": 13,
    "å…‰": 6, "æš—": 13, "æ˜": 8, "ç™½": 5, "é»’": 11, "èµ¤": 7, "é’": 8, "ç·‘": 14, "é»„": 12,
    "ç´«": 12, "èŒ¶": 9, "ç°": 6, "è‰²": 6, "å½¢": 7, "æ¨¡æ§˜": 16, "æŸ„": 9, "è³ª": 15, "æ": 7,
    "ç´™": 10, "æœ¨": 4, "çŸ³": 5, "é‰„": 13, "éŠ…": 14, "éŠ€": 14, "é‡‘": 8, "å®çŸ³": 16, "ãƒ€ã‚¤ãƒ¤": 12,
    "æ•°å­—": 13, "æ–‡å­—": 6, "è¨€è‘‰": 12, "è¨€èª": 16, "æ—¥æœ¬èª": 12, "è‹±èª": 12, "ä¸­å›½èª": 12,
    "éŸ“å›½èª": 12, "ãƒ•ãƒ©ãƒ³ã‚¹èª": 16, "ãƒ‰ã‚¤ãƒ„èª": 16, "ã‚¹ãƒšã‚¤ãƒ³èª": 16, "ã‚¤ã‚¿ãƒªã‚¢èª": 16,
    "ãƒ­ã‚·ã‚¢èª": 16, "ã‚¢ãƒ©ãƒ“ã‚¢èª": 16, "ãƒ’ãƒ³ãƒ‡ã‚£ãƒ¼èª": 16, "ã‚¿ã‚¤èª": 16, "ãƒ™ãƒˆãƒŠãƒ èª": 16,
    "éŸ³æ¥½": 12, "æ­Œ": 14, "è¸Š": 14, "æ¼”": 15, "åŠ‡": 15, "æ˜ ç”»": 16, "ãƒ†ãƒ¬ãƒ“": 16, "ãƒ©ã‚¸ã‚ª": 16,
    "æ–°è": 16, "é›‘èªŒ": 16, "æœ¬": 5, "å°èª¬": 12, "è©©": 13, "çµµ": 12, "å†™çœŸ": 12, "ç”»": 8,
    "å½«åˆ»": 16, "å·¥èŠ¸": 12, "æ–™ç†": 16, "é£Ÿã¹ç‰©": 16, "é£²ã¿ç‰©": 16, "æœç‰©": 16, "é‡èœ": 16,
    "è‚‰": 6, "é­š": 11, "ç±³": 6, "ãƒ‘ãƒ³": 12, "éºº": 12, "ã‚¹ãƒ¼ãƒ—": 12, "ã‚µãƒ©ãƒ€": 12, "ã‚±ãƒ¼ã‚­": 12,
    "ãŠè“å­": 12, "ã‚¢ã‚¤ã‚¹": 12, "ã‚¸ãƒ¥ãƒ¼ã‚¹": 12, "ãŠèŒ¶": 12, "ã‚³ãƒ¼ãƒ’ãƒ¼": 12, "ãƒ“ãƒ¼ãƒ«": 12,
    "ãƒ¯ã‚¤ãƒ³": 12, "é…’": 10, "æ°´": 4, "ç‰›ä¹³": 12, "ç ‚ç³–": 16, "å¡©": 16, "æ²¹": 8, "é†¤æ²¹": 16,
    "å‘³å™Œ": 16, "é…¢": 15, "èƒ¡æ¤’": 16, "é¦™è¾›æ–™": 16, "èª¿å‘³æ–™": 16, "ã‚¹ãƒ‘ã‚¤ã‚¹": 16,
    "ã‚¹ãƒãƒ¼ãƒ„": 16, "é‡çƒ": 16, "ã‚µãƒƒã‚«ãƒ¼": 16, "ãƒ†ãƒ‹ã‚¹": 16, "ãƒã‚¹ã‚±ãƒƒãƒˆ": 16, "ãƒãƒ¬ãƒ¼": 16,
    "æ°´æ³³": 16, "ãƒãƒ©ã‚½ãƒ³": 16, "æŸ”é“": 16, "å‰£é“": 16, "ç©ºæ‰‹": 16, "ç›¸æ’²": 16, "æ ¼é—˜æŠ€": 16,
    "ä½“æ“": 16, "ãƒ€ãƒ³ã‚¹": 16, "ãƒ¨ã‚¬": 16, "ãƒ”ãƒ©ãƒ†ã‚£ã‚¹": 16, "ã‚¸ãƒ§ã‚®ãƒ³ã‚°": 16, "ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°": 16,
    "ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚°": 16, "ã‚¹ã‚­ãƒ¼": 16, "ã‚¹ãƒãƒ¼ãƒœãƒ¼ãƒ‰": 16, "ã‚¹ã‚±ãƒ¼ãƒˆ": 16, "ã‚µãƒ¼ãƒ•ã‚£ãƒ³": 16,
    "é‡£": 8, "ç™»å±±": 12, "ã‚­ãƒ£ãƒ³ãƒ—": 16, "ãƒã‚¤ã‚­ãƒ³ã‚°": 16, "æ—…è¡Œ": 16, "è¦³å…‰": 16,
    "ä»•äº‹": 12, "ä¼šç¤¾": 12, "å­¦æ ¡": 12, "ç—…é™¢": 16, "éŠ€è¡Œ": 16, "éƒµä¾¿å±€": 16, "è­¦å¯Ÿ": 16,
    "æ¶ˆé˜²": 16, "å½¹æ‰€": 16, "å›³æ›¸é¤¨": 16, "ç¾è¡“é¤¨": 16, "åšç‰©é¤¨": 16, "å‹•ç‰©åœ’": 16,
    "éŠåœ’åœ°": 16, "æ˜ ç”»é¤¨": 16, "åŠ‡å ´": 16, "ã‚³ãƒ³ã‚µãƒ¼ãƒˆ": 16, "ãƒ©ã‚¤ãƒ–": 16, "ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼": 16,
    "çµå©šå¼": 16, "è‘¬å¼": 16, "èª•ç”Ÿæ—¥": 16, "è¨˜å¿µæ—¥": 16, "ç¥æ—¥": 16, "ç¥­": 13, "ç¥­ã‚Š": 13,
    "æ­£æœˆ": 12, "ã‚¯ãƒªã‚¹ãƒã‚¹": 16, "ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³": 16, "ãƒãƒ­ã‚¦ã‚£ãƒ³": 16, "ã‚¤ãƒ¼ã‚¹ã‚¿ãƒ¼": 16,
    "ãŠç›†": 12, "å½¼å²¸": 12, "ç¯€åˆ†": 12, "ã²ãªç¥­ã‚Š": 12, "ã“ã©ã‚‚ã®æ—¥": 12, "æ¯ã®æ—¥": 12,
    "çˆ¶ã®æ—¥": 12, "æ•¬è€ã®æ—¥": 12, "ä½“è‚²ã®æ—¥": 12, "æ–‡åŒ–ã®æ—¥": 12, "å‹¤åŠ´æ„Ÿè¬ã®æ—¥": 16,
    "å¤©çš‡èª•ç”Ÿæ—¥": 16, "æ˜­å’Œã®æ—¥": 16, "ã¿ã©ã‚Šã®æ—¥": 16, "æµ·ã®æ—¥": 16, "å±±ã®æ—¥": 16,
    "ä¼‘æ—¥": 12, "å¹³æ—¥": 12, "é€±æœ«": 12, "é€£ä¼‘": 12, "å¤ä¼‘ã¿": 12, "å†¬ä¼‘ã¿": 12, "æ˜¥ä¼‘ã¿": 12,
    "é•·æœŸä¼‘æš‡": 16, "æœ‰çµ¦": 12, "ç—…æ°—": 12, "æ€ªæˆ‘": 12, "å¥åº·": 12, "åŒ»ç™‚": 16, "æ²»ç™‚": 16,
    "æ‰‹è¡“": 16, "è–¬": 16, "æ³¨å°„": 16, "æ¤œæŸ»": 16, "è¨ºå¯Ÿ": 16, "å…¥é™¢": 16, "é€€é™¢": 16,
    "åŒ»è€…": 12, "çœ‹è­·å¸«": 16, "è–¬å‰¤å¸«": 16, "æ­¯åŒ»è€…": 16, "çœ¼ç§‘": 16, "è€³é¼»ç§‘": 16,
    "å°å…ç§‘": 16, "ç”£å©¦äººç§‘": 16, "å†…ç§‘": 16, "å¤–ç§‘": 16, "æ•´å½¢å¤–ç§‘": 16, "çš®è†šç§‘": 16,
    "ç²¾ç¥ç§‘": 16, "å¿ƒç™‚å†…ç§‘": 16, "ç¥çµŒç§‘": 16, "è„³å¤–ç§‘": 16, "å¿ƒè‡“å¤–ç§‘": 16, "å‘¼å¸å™¨ç§‘": 16,
    "æ¶ˆåŒ–å™¨ç§‘": 16, "æ³Œå°¿å™¨ç§‘": 16, "å¾ªç’°å™¨ç§‘": 16, "å†…åˆ†æ³Œç§‘": 16, "è¡€æ¶²å†…ç§‘": 16,
    "è…«ç˜ç§‘": 16, "æ”¾å°„ç·šç§‘": 16, "éº»é…”ç§‘": 16, "æ•‘æ€¥ç§‘": 16, "ãƒªãƒãƒ“ãƒª": 16, "ç†å­¦ç™‚æ³•": 16,
    "ä½œæ¥­ç™‚æ³•": 16, "è¨€èªç™‚æ³•": 16, "å¿ƒç†ç™‚æ³•": 16, "ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°": 16, "ã‚»ãƒ©ãƒ”ãƒ¼": 16,
    "ãƒãƒƒã‚µãƒ¼ã‚¸": 16, "é¼": 16, "ç¸": 16, "æ•´ä½“": 16, "ã‚«ã‚¤ãƒ­": 16, "æŒ‡åœ§": 16, "ã‚ã‚“æ‘©": 16,
    "ãƒ¨ã‚¬": 16, "ãƒ”ãƒ©ãƒ†ã‚£ã‚¹": 16, "å¤ªæ¥µæ‹³": 16, "æ°—åŠŸ": 16, "ç‘æƒ³": 16, "åº§ç¦…": 16,
    "å®—æ•™": 12, "ç¥": 9, "ä»": 7, "ã‚­ãƒªã‚¹ãƒˆ": 12, "ã‚¤ã‚¹ãƒ©ãƒ ": 12, "ãƒ¦ãƒ€ãƒ¤": 12, "ãƒ’ãƒ³ãƒ‰ã‚¥ãƒ¼": 12,
    "ä»æ•™": 12, "ç¥é“": 12, "ã‚­ãƒªã‚¹ãƒˆæ•™": 12, "ã‚¤ã‚¹ãƒ©ãƒ æ•™": 12, "ãƒ¦ãƒ€ãƒ¤æ•™": 12, "ãƒ’ãƒ³ãƒ‰ã‚¥ãƒ¼æ•™": 12,
    "ãŠå¯º": 12, "ç¥ç¤¾": 12, "æ•™ä¼š": 12, "ãƒ¢ã‚¹ã‚¯": 12, "ã‚·ãƒŠã‚´ãƒ¼ã‚°": 12, "å¯ºé™¢": 12,
    "ãŠåŠã•ã‚“": 12, "ç¥ä¸»": 12, "ç‰§å¸«": 12, "ã‚¤ãƒãƒ¼ãƒ ": 12, "ãƒ©ãƒ“": 12, "åƒ§ä¾¶": 12,
    "ãŠçµŒ": 12, "è–æ›¸": 12, "ã‚³ãƒ¼ãƒ©ãƒ³": 12, "ãƒˆãƒ¼ãƒ©ãƒ¼": 12, "ãƒ´ã‚§ãƒ¼ãƒ€": 12, "ä»å…¸": 12,
    "ç¥ˆ": 8, "ç¥ˆã‚Š": 8, "é¡˜": 19, "é¡˜ã„": 19, "å¸Œæœ›": 12, "å¤¢": 13, "ç›®æ¨™": 12, "ç›®çš„": 12,
    "è¨ˆç”»": 16, "äºˆå®š": 12, "ç´„æŸ": 16, "ç´„æŸäº‹": 16, "ãƒ«ãƒ¼ãƒ«": 12, "è¦å‰‡": 16, "æ³•å¾‹": 16,
    "æ†²æ³•": 16, "æ¡ä¾‹": 16, "æ”¿ä»¤": 16, "çœä»¤": 16, "é€šé”": 16, "é€šçŸ¥": 16, "æŒ‡ç¤º": 16,
    "å‘½ä»¤": 16, "è¦è«‹": 16, "ä¾é ¼": 16, "ç›¸è«‡": 16, "è³ªå•": 16, "å›ç­”": 16, "è¿”ç­”": 16,
    "è¿”äº‹": 16, "è¿”ä¿¡": 16, "é€£çµ¡": 16, "å ±å‘Š": 16, "é€£çµ¡": 16, "å ±å‘Š": 16, "ç™ºè¡¨": 16,
    "ç™ºè¡¨": 16, "ç™ºè¡¨": 16, "ç™ºè¡¨": 16, "ç™ºè¡¨": 16, "ç™ºè¡¨": 16, "ç™ºè¡¨": 16, "ç™ºè¡¨": 16,
  }

  if (character === "ã€…") {
    return 0 // ç¹°ã‚Šè¿”ã—æ–‡å­—ã¯å‰ã®æ–‡å­—ã®ç”»æ•°ã‚’å‚ç…§ã™ã‚‹ãŸã‚ã€ã“ã“ã§ã¯0ã‚’è¿”ã™
  }

  return strokeData[character] || 0
}

// ç¹°ã‚Šè¿”ã—æ–‡å­—ã€Œã€…ã€ã®ç”»æ•°ã‚’å‰ã®æ–‡å­—ã‹ã‚‰å–å¾—ã™ã‚‹é–¢æ•°
function getReisuuStrokeCount(text: string, position: number): number {
  if (position === 0) return 0
  return getStrokeCount(text[position - 1])
}

// éœŠæ•°ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ã—ãŸç”»æ•°è¨ˆç®—
function calculateStrokesWithReisuu(text: string): { count: number; hasReisuu: boolean } {
  let total = 0
  let hasReisuu = false

  for (let i = 0; i < text.length; i++) {
    if (text[i] === "ã€…") {
      total += getReisuuStrokeCount(text, i)
      hasReisuu = true
    } else {
      total += getStrokeCount(text[i])
    }
  }

  return { count: total, hasReisuu }
}

// ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‰å‡¶ã‚’å–å¾—ã™ã‚‹é–¢æ•°ï¼ˆæ€§åˆ¥è€ƒæ…®ï¼‰
function getFortuneFromCustomDataWithGender(
  strokeCount: number,
  customData: Record<string, any>,
  gender: string
): any {
  console.log(`ğŸ” getFortuneFromCustomDataWithGenderå‘¼ã³å‡ºã—:`, {
    strokeCount,
    gender,
    customDataExists: !!customData,
    customDataKeys: customData ? Object.keys(customData).length : 0
  })

  const key = strokeCount.toString()
  const data = customData[key]

  console.log(`ğŸ” å–å¾—ãƒ‡ãƒ¼ã‚¿:`, {
    key,
    data,
    dataExists: !!data
  })

  if (!data) {
    console.log(`âš ï¸ ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${key}ç”»`)
  return {
      é‹å‹¢: "ä¸­å‰",
      èª¬æ˜: "ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚",
      ç‚¹æ•°: 50
    }
  }

  console.log(`âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ:`, data)
  return data
}

// analyzeNameFortuneé–¢æ•° - éœŠæ•°ãƒ«ãƒ¼ãƒ«ã‚’çµ„ã¿è¾¼ã¿ï¼ˆãƒ¡ã‚¤ãƒ³é–¢æ•°ï¼‰- æœ€é©åŒ–ç‰ˆ
export function analyzeNameFortune(
  lastName: string,
  firstName: string,
  gender = "male",
  customFortuneData?: Record<string, any>, // ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã«å¤‰æ›´
): any {
  try {
    console.log(`ğŸ¯ analyzeNameFortuneé–‹å§‹: "${lastName} ${firstName}" (${gender})`)
    console.log(`ğŸ” customFortuneDataæä¾›çŠ¶æ³:`, !!customFortuneData)
    console.log(`ğŸ” customFortuneDataå‹:`, typeof customFortuneData)
    if (customFortuneData) {
      console.log(`ğŸ” customFortuneDataä»¶æ•°:`, Object.keys(customFortuneData).length)
      console.log(`ğŸ” customFortuneDataå…ˆé ­5ä»¶:`, Object.keys(customFortuneData).slice(0, 5))
    } else {
      console.log(`âš ï¸ customFortuneDataãŒundefinedã¾ãŸã¯nullã§ã™`)
    }
    
    console.log(`ğŸ” é–¢æ•°å®Ÿè¡Œé–‹å§‹: éœŠæ•°è¨ˆç®—å‰`)

    // customFortuneDataãŒæä¾›ã•ã‚Œã¦ã„ãªã„å ´åˆã€ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
  if (!customFortuneData) {
      console.log("âš ï¸ customFortuneDataãŒæä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’è©¦è¡Œã—ã¾ã™ã€‚")
      try {
        // ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        const { customFortuneData: importedData } = require("./fortune-data-custom")
        customFortuneData = importedData
        console.log("âœ… ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ:", Object.keys(customFortuneData).length, "ä»¶")
      } catch (error) {
        console.error("ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—:", error)
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é‹å‹¢ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
    customFortuneData = {
      // åŸºæœ¬çš„ãªé‹å‹¢ãƒ‡ãƒ¼ã‚¿ï¼ˆç°¡æ˜“ç‰ˆï¼‰
      "1": { é‹å‹¢: "å¤§å‰", èª¬æ˜: "ç‹¬ç«‹å¿ƒæ—ºç››ã§ã€ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã—ã¾ã™ã€‚" },
      "2": { é‹å‹¢: "å‡¶", èª¬æ˜: "å”èª¿æ€§ã¯ã‚ã‚Šã¾ã™ãŒã€å„ªæŸ”ä¸æ–­ãªé¢ãŒã‚ã‚Šã¾ã™ã€‚" },
      "3": { é‹å‹¢: "å¤§å‰", èª¬æ˜: "æ˜ã‚‹ãç©æ¥µçš„ã§ã€äººæ°—è€…ã«ãªã‚Šã¾ã™ã€‚" },
      "4": { é‹å‹¢: "å‡¶", èª¬æ˜: "çœŸé¢ç›®ã§ã™ãŒã€è‹¦åŠ´ãŒå¤šã„å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚" },
      "5": { é‹å‹¢: "å¤§å‰", èª¬æ˜: "ãƒãƒ©ãƒ³ã‚¹æ„Ÿè¦šã«å„ªã‚Œã€å®‰å®šã—ãŸäººç”Ÿã‚’é€ã‚Šã¾ã™ã€‚" },
      "6": { é‹å‹¢: "å¤§å‰", èª¬æ˜: "è²¬ä»»æ„ŸãŒå¼·ãã€å®¶æ—æ€ã„ã§ã™ã€‚" },
      "7": { é‹å‹¢: "å‰", èª¬æ˜: "ç‹¬ç«‹å¿ƒãŒã‚ã‚Šã€å°‚é–€åˆ†é‡ã§æˆåŠŸã—ã¾ã™ã€‚" },
      "8": { é‹å‹¢: "å¤§å‰", èª¬æ˜: "æ„å¿—ãŒå¼·ãã€å›°é›£ã‚’ä¹—ã‚Šè¶Šãˆã‚‹åŠ›ãŒã‚ã‚Šã¾ã™ã€‚" },
      "9": { é‹å‹¢: "å‡¶", èª¬æ˜: "é ­è„³æ˜æ™°ã§ã™ãŒã€å¤‰åŒ–ã®å¤šã„äººç”Ÿã«ãªã‚Šã¾ã™ã€‚" },
      "10": { é‹å‹¢: "å‡¶", èª¬æ˜: "æ³¢ä¹±ä¸‡ä¸ˆãªäººç”Ÿã§ã™ãŒã€æœ€çµ‚çš„ã«ã¯æˆåŠŸã—ã¾ã™ã€‚" },
    }
    // 11-81ç”»ã¾ã§ã®åŸºæœ¬çš„ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ç”Ÿæˆ
    for (let i = 11; i <= 81; i++) {
      if (!customFortuneData[i.toString()]) {
        const mod = i % 10
        if ([1, 3, 5, 6, 8].includes(mod)) {
          customFortuneData[i.toString()] = { é‹å‹¢: "å‰", èª¬æ˜: "è‰¯å¥½ãªé‹å‹¢ã§ã™ã€‚" }
        } else if ([2, 4, 9].includes(mod)) {
          customFortuneData[i.toString()] = { é‹å‹¢: "å‡¶", èª¬æ˜: "æ³¨æ„ãŒå¿…è¦ãªé‹å‹¢ã§ã™ã€‚" }
        } else {
          customFortuneData[i.toString()] = { é‹å‹¢: "ä¸­å‰", èª¬æ˜: "æ™®é€šã®é‹å‹¢ã§ã™ã€‚" }
            }
          }
        }
      }
    }

    // éœŠæ•°ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ã—ãŸç”»æ•°è¨ˆç®—
    const lastNameResult = calculateStrokesWithReisuu(lastName)
    const firstNameResult = calculateStrokesWithReisuu(firstName)

    const lastNameCount = lastNameResult.count
    const firstNameCount = firstNameResult.count
    const hasReisuuInLastName = lastNameResult.hasReisuu
    const hasReisuuInFirstName = firstNameResult.hasReisuu

    console.log(`ğŸ” éœŠæ•°è¨ˆç®—çµæœ:`, {
      lastName,
      firstName,
      lastNameCount,
      firstNameCount,
      hasReisuuInLastName,
      hasReisuuInFirstName
    })

    // VBAãƒ­ã‚¸ãƒƒã‚¯ã«åŸºã¥ãäº”æ ¼è¨ˆç®—
    // å¤©æ ¼ï¼ˆå§“ã®ç·ç”»æ•°ã€éœŠæ•°å«ã‚€ï¼‰
  const tenFormat = lastNameCount

    // äººæ ¼ï¼ˆå§“ã®æœ€å¾Œã®æ–‡å­— + åã®æœ€åˆã®æ–‡å­—ã€éœŠæ•°é™¤å¤–ï¼‰
    const lastCharStroke = getStrokeCount(lastName[lastName.length - 1])
    const firstCharStroke = firstName.length > 0 ? getStrokeCount(firstName[0]) : 0
    const jinFormat = lastCharStroke + firstCharStroke

    // åœ°æ ¼ï¼ˆåã®ç·ç”»æ•°ã€éœŠæ•°å«ã‚€ï¼‰
  const chiFormat = firstNameCount

    // å¤–æ ¼ï¼ˆå§“ã®æœ€åˆã®æ–‡å­— + åã®æœ€å¾Œã®æ–‡å­—ã€éœŠæ•°é™¤å¤–ï¼‰
    const firstCharLastNameStroke = getStrokeCount(lastName[0])
    const lastCharFirstNameStroke = firstName.length > 0 ? getStrokeCount(firstName[firstName.length - 1]) : 0
    const gaiFormat = firstCharLastNameStroke + lastCharFirstNameStroke

    // ç·æ ¼ï¼ˆå¤©æ ¼ + åœ°æ ¼ï¼‰
    const totalFormat = tenFormat + chiFormat

    console.log(`ğŸ” äº”æ ¼è¨ˆç®—çµæœ:`, {
      tenFormat,
      jinFormat,
      chiFormat,
      gaiFormat,
      totalFormat
    })

  // å„æ ¼ã®å‰å‡¶ã‚’å–å¾—ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼‰
    console.log("ğŸ” å‰å‡¶ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ‡ãƒãƒƒã‚°é–‹å§‹")
    console.log("ğŸ” å‰å‡¶ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ‡ãƒãƒƒã‚°:", {
      tenFormat,
      jinFormat,
      chiFormat,
      gaiFormat,
      totalFormat,
      customFortuneData16: customFortuneData["16"],
      customFortuneData23: customFortuneData["23"],
      customFortuneData31: customFortuneData["31"],
      customFortuneData24: customFortuneData["24"],
      customFortuneData47: customFortuneData["47"]
    })
    console.log("ğŸ” å‰å‡¶ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ‡ãƒãƒƒã‚°å®Œäº†")

  const tenFortune = getFortuneFromCustomDataWithGender(tenFormat, customFortuneData, gender)
  const jinFortune = getFortuneFromCustomDataWithGender(jinFormat, customFortuneData, gender)
  const chiFortune = getFortuneFromCustomDataWithGender(chiFormat, customFortuneData, gender)
  const gaiFortune = getFortuneFromCustomDataWithGender(gaiFormat, customFortuneData, gender)
  const totalFortune = getFortuneFromCustomDataWithGender(totalFormat, customFortuneData, gender)

    console.log("ğŸ” å–å¾—ã•ã‚ŒãŸå‰å‡¶ãƒ‡ãƒ¼ã‚¿:", {
      tenFortune,
      jinFortune,
      chiFortune,
      gaiFortune,
      totalFortune
    })

    // çµæœã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
  const result = {
      name: `${lastName} ${firstName}`,
      lastName: lastName,
      firstName: firstName,
      gender: gender,
    categories: [
      {
        name: "å¤©æ ¼",
          strokes: tenFormat,
          fortune: tenFortune.é‹å‹¢ || "ä¸­å‰",
          description: tenFortune.èª¬æ˜ || "å¤©æ ¼ã®èª¬æ˜",
          score: tenFortune.ç‚¹æ•° || 50
      },
      {
        name: "äººæ ¼",
          strokes: jinFormat,
          fortune: jinFortune.é‹å‹¢ || "ä¸­å‰",
          description: jinFortune.èª¬æ˜ || "äººæ ¼ã®èª¬æ˜",
          score: jinFortune.ç‚¹æ•° || 50
      },
      {
        name: "åœ°æ ¼",
          strokes: chiFormat,
          fortune: chiFortune.é‹å‹¢ || "ä¸­å‰",
          description: chiFortune.èª¬æ˜ || "åœ°æ ¼ã®èª¬æ˜",
          score: chiFortune.ç‚¹æ•° || 50
      },
      {
        name: "å¤–æ ¼",
          strokes: gaiFormat,
          fortune: gaiFortune.é‹å‹¢ || "ä¸­å‰",
          description: gaiFortune.èª¬æ˜ || "å¤–æ ¼ã®èª¬æ˜",
          score: gaiFortune.ç‚¹æ•° || 50
      },
      {
        name: "ç·æ ¼",
          strokes: totalFormat,
          fortune: totalFortune.é‹å‹¢ || "ä¸­å‰",
          description: totalFortune.èª¬æ˜ || "ç·æ ¼ã®èª¬æ˜",
          score: totalFortune.ç‚¹æ•° || 50
        }
      ],
    tenFormat: tenFormat,
    jinFormat: jinFormat,
    chiFormat: chiFormat,
    gaiFormat: gaiFormat,
    totalFormat: totalFormat,
  }

  if (DEBUG_MODE) {
    console.log(`ğŸ¯ analyzeNameFortuneå®Œäº†:`, result)
  }

  return result
  } catch (error) {
    console.error("âŒ analyzeNameFortuneé–¢æ•°ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error)
    console.error("âŒ ã‚¨ãƒ©ãƒ¼ã®è©³ç´°:", {
      lastName,
      firstName,
      gender,
      customFortuneDataProvided: !!customFortuneData,
      errorMessage: error.message,
      errorStack: error.stack
    })
    throw error
  }
}
