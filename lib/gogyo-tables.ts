// 天運早見表のデータ
// 年と九星・五行の対応表
export type NineStar =
  | "一白水星"
  | "二黒土星"
  | "三碧木星"
  | "四緑木星"
  | "五黄土星"
  | "六白金星"
  | "七赤金星"
  | "八白土星"
  | "九紫火星"
export type FiveElement = "木星" | "火星" | "土星" | "金星" | "水星"

// 九星から五行への変換マップ
export const nineStarToElement: Record<NineStar, FiveElement> = {
  一白水星: "水星",
  二黒土星: "土星",
  三碧木星: "木星",
  四緑木星: "木星",
  五黄土星: "土星",
  六白金星: "金星",
  七赤金星: "金星",
  八白土星: "土星",
  九紫火星: "火星",
}

// 年から九星を取得するためのデータ
// 早見表のデータを構造化
export const yearToNineStar: Record<number, NineStar> = {
  // 1926年から2033年までのデータ
  1926: "二黒土星",
  1927: "一白水星",
  1928: "九紫火星",
  1929: "八白土星",
  1930: "七赤金星",
  1931: "六白金星",
  1932: "五黄土星",
  1933: "四緑木星",
  1934: "三碧木星",
  1935: "二黒土星",
  1936: "一白水星",
  1937: "九紫火星",
  1938: "八白土星",
  1939: "七赤金星",
  1940: "六白金星",
  1941: "五黄土星",
  1942: "四緑木星",
  1943: "三碧木星",
  1944: "二黒土星",
  1945: "一白水星",
  1946: "九紫火星",
  1947: "八白土星",
  1948: "七赤金星",
  1949: "六白金星",
  1950: "五黄土星",
  1951: "四緑木星",
  1952: "三碧木星",
  1953: "二黒土星",
  1954: "一白水星",
  1955: "九紫火星",
  1956: "八白土星",
  1957: "七赤金星",
  1958: "六白金星",
  1959: "五黄土星",
  1960: "四緑木星",
  1961: "三碧木星",
  1962: "二黒土星",
  1963: "一白水星",
  1964: "九紫火星",
  1965: "八白土星",
  1966: "七赤金星",
  1967: "六白金星",
  1968: "五黄土星",
  1969: "四緑木星",
  1970: "三碧木星",
  1971: "二黒土星",
  1972: "一白水星",
  1973: "九紫火星",
  1974: "八白土星",
  1975: "七赤金星",
  1976: "六白金星",
  1977: "五黄土星",
  1978: "四緑木星",
  1979: "三碧木星",
  1980: "二黒土星",
  1981: "一白水星",
  1982: "九紫火星",
  1983: "八白土星",
  1984: "七赤金星",
  1985: "六白金星",
  1986: "五黄土星",
  1987: "四緑木星",
  1988: "三碧木星",
  1989: "二黒土星",
  1990: "一白水星",
  1991: "九紫火星",
  1992: "八白土星",
  1993: "七赤金星",
  1994: "六白金星",
  1995: "五黄土星",
  1996: "四緑木星",
  1997: "三碧木星",
  1998: "二黒土星",
  1999: "一白水星",
  2000: "九紫火星",
  2001: "八白土星",
  2002: "七赤金星",
  2003: "六白金星",
  2004: "五黄土星",
  2005: "四緑木星",
  2006: "三碧木星",
  2007: "二黒土星",
  2008: "一白水星",
  2009: "九紫火星",
  2010: "八白土星",
  2011: "七赤金星",
  2012: "六白金星",
  2013: "五黄土星",
  2014: "四緑木星",
  2015: "三碧木星",
  2016: "二黒土星",
  2017: "一白水星",
  2018: "九紫火星",
  2019: "八白土星",
  2020: "七赤金星",
  2021: "六白金星",
  2022: "五黄土星",
  2023: "四緑木星",
  2024: "三碧木星",
  2025: "二黒土星",
  2026: "一白水星",
  2027: "九紫火星",
  2028: "八白土星",
  2029: "七赤金星",
  2030: "六白金星",
  2031: "五黄土星",
  2032: "四緑木星",
  2033: "三碧木星",
}

// 年から直接天運の星を取得するマッピング
export const yearToTenunStars: Record<number, [FiveElement, FiveElement]> = {
  // 1926年から2033年までのデータ
  1926: ["木星", "木星"],
  1927: ["木星", "木星"],
  1928: ["土星", "土星"],
  1929: ["火星", "火星"],
  1930: ["火星", "火星"],
  1931: ["土星", "土星"],
  1932: ["金星", "金星"],
  1933: ["金星", "金星"],
  1934: ["土星", "土星"],
  1935: ["水星", "水星"],
  1936: ["水星", "水星"],
  1937: ["土星", "土星"],
  1938: ["木星", "木星"],
  1939: ["木星", "木星"],
  1940: ["土星", "土星"],
  1941: ["火星", "火星"],
  1942: ["火星", "火星"],
  1943: ["土星", "土星"],
  1944: ["金星", "金星"],
  1945: ["金星", "金星"],
  1946: ["土星", "土星"],
  1947: ["水星", "水星"],
  1948: ["水星", "水星"],
  1949: ["土星", "土星"],
  1950: ["木星", "木星"],
  1951: ["木星", "木星"],
  1952: ["土星", "土星"],
  1953: ["火星", "火星"],
  1954: ["火星", "火星"],
  1955: ["土星", "土星"],
  1956: ["金星", "金星"],
  1957: ["金星", "金星"],
  1958: ["土星", "土星"],
  1959: ["水星", "水星"],
  1960: ["水星", "水星"],
  1961: ["土星", "土星"],
  1962: ["木星", "木星"],
  1963: ["木星", "木星"],
  1964: ["土星", "土星"],
  1965: ["火星", "火星"],
  1966: ["火星", "火星"],
  1967: ["土星", "土星"],
  1968: ["金星", "金星"],
  1969: ["金星", "木星"], // 修正：1969年は「金星、木星」
  1970: ["土星", "土星"],
  1971: ["水星", "水星"],
  1972: ["水星", "水星"],
  1973: ["土星", "土星"],
  1974: ["木星", "木星"],
  1975: ["木星", "木星"],
  1976: ["土星", "土星"],
  1977: ["火星", "火星"],
  1978: ["火星", "火星"],
  1979: ["土星", "土星"],
  1980: ["金星", "金星"],
  1981: ["金星", "金星"],
  1982: ["土星", "土星"],
  1983: ["水星", "水星"],
  1984: ["水星", "水星"],
  1985: ["土星", "土星"],
  1986: ["木星", "木星"],
  1987: ["木星", "木星"],
  1988: ["土星", "土星"],
  1989: ["火星", "火星"],
  1990: ["火星", "火星"],
  1991: ["土星", "土星"],
  1992: ["金星", "金星"],
  1993: ["金星", "金星"],
  1994: ["土星", "土星"],
  1995: ["水星", "水星"],
  1996: ["水星", "水星"],
  1997: ["土星", "土星"],
  1998: ["木星", "木星"],
  1999: ["木星", "木星"],
  2000: ["土星", "土星"],
  2001: ["火星", "火星"],
  2002: ["火星", "火星"],
  2003: ["土星", "土星"],
  2004: ["金星", "金星"],
  2005: ["金星", "金星"],
  2006: ["土星", "土星"],
  2007: ["水星", "水星"],
  2008: ["水星", "水星"],
  2009: ["土星", "土星"],
  2010: ["木星", "木星"],
  2011: ["木星", "木星"],
  2012: ["土星", "土星"],
  2013: ["火星", "火星"],
  2014: ["火星", "火星"],
  2015: ["土星", "土星"],
  2016: ["金星", "金星"],
  2017: ["金星", "金星"],
  2018: ["土星", "土星"],
  2019: ["水星", "水星"],
  2020: ["水星", "水星"],
  2021: ["土星", "土星"],
  2022: ["木星", "木星"],
  2023: ["木星", "木星"],
  2024: ["土星", "土星"],
  2025: ["火星", "火星"],
  2026: ["火星", "火星"],
  2027: ["土星", "土星"],
  2028: ["金星", "金星"],
  2029: ["金星", "金星"],
  2030: ["土星", "土星"],
  2031: ["水星", "水星"],
  2032: ["水星", "水星"],
  2033: ["土星", "土星"],
}

// 天運から導き出される星のマッピング（九星から2つの星を取得）
// 注：yearToTenunStarsを優先して使用し、該当する年がない場合のみこちらを使用
export const tenunToStars: Record<NineStar, [FiveElement, FiveElement]> = {
  一白水星: ["水星", "水星"],
  二黒土星: ["木星", "木星"],
  三碧木星: ["土星", "土星"],
  四緑木星: ["水星", "水星"],
  五黄土星: ["金星", "金星"],
  六白金星: ["土星", "土星"],
  七赤金星: ["木星", "木星"],
  八白土星: ["火星", "火星"],
  九紫火星: ["土星", "土星"],
}

// 月日早見表のデータ
// 月日の期間を定義
export type DateRange = {
  start: { month: number; day: number }
  end: { month: number; day: number }
}

export const dateRanges: DateRange[] = [
  { start: { month: 1, day: 6 }, end: { month: 2, day: 3 } },
  { start: { month: 2, day: 4 }, end: { month: 3, day: 5 } },
  { start: { month: 3, day: 6 }, end: { month: 4, day: 4 } },
  { start: { month: 4, day: 5 }, end: { month: 5, day: 5 } },
  { start: { month: 5, day: 6 }, end: { month: 6, day: 5 } },
  { start: { month: 6, day: 6 }, end: { month: 7, day: 7 } },
  { start: { month: 7, day: 8 }, end: { month: 8, day: 7 } },
  { start: { month: 8, day: 8 }, end: { month: 9, day: 7 } },
  { start: { month: 9, day: 8 }, end: { month: 10, day: 8 } },
  { start: { month: 10, day: 9 }, end: { month: 11, day: 7 } },
  { start: { month: 11, day: 8 }, end: { month: 12, day: 7 } },
  { start: { month: 12, day: 8 }, end: { month: 1, day: 5 } },
]

// 月日と天運から導き出される星のマッピング
export const monthDayStars: Record<number, Record<NineStar, [FiveElement, FiveElement]>> = {
  0: {
    // 1月6日~2月3日
    一白水星: ["土星", "金星"],
    二黒土星: ["火星", "土星"],
    三碧木星: ["木星", "土星"],
    四緑木星: ["土星", "金星"],
    五黄土星: ["火星", "土星"],
    六白金星: ["木星", "土星"],
    七赤金星: ["土星", "金星"],
    八白土星: ["火星", "土星"],
    九紫火星: ["木星", "土星"],
  },
  1: {
    // 2月4日~3月5日
    一白水星: ["木星", "水星"],
    二黒土星: ["土星", "水星"],
    三碧木星: ["金星", "水星"],
    四緑木星: ["木星", "水星"],
    五黄土星: ["土星", "水星"],
    六白金星: ["金星", "水星"],
    七赤金星: ["木星", "水星"],
    八白土星: ["土星", "水星"],
    九紫火星: ["金星", "水星"],
  },
  2: {
    // 3月6日~4月4日
    一白水星: ["金星", "金星"],
    二黒土星: ["木星", "水星"],
    三碧木星: ["木星", "木星"],
    四緑木星: ["金星", "金星"],
    五黄土星: ["木星", "水星"],
    六白金星: ["木星", "木星"],
    七赤金星: ["金星", "金星"],
    八白土星: ["木星", "水星"],
    九紫火星: ["木星", "木星"],
  },
  3: {
    // 4月5日~5月5日
    一白水星: ["土星", "金星"],
    二黒土星: ["火星", "土星"],
    三碧木星: ["木星", "土星"],
    四緑木星: ["土星", "金星"],
    五黄土星: ["火星", "土星"],
    六白金星: ["木星", "土星"],
    七赤金星: ["土星", "金星"],
    八白土星: ["火星", "土星"],
    九紫火星: ["木星", "土星"],
  },
  4: {
    // 5月6日~6月5日
    一白水星: ["火星", "土星"],
    二黒土星: ["火星", "土星"],
    三碧木星: ["火星", "土星"],
    四緑木星: ["火星", "土星"],
    五黄土星: ["火星", "土星"],
    六白金星: ["火星", "土星"],
    七赤金星: ["火星", "土星"],
    八白土星: ["火星", "土星"],
    九紫火星: ["火星", "土星"],
  },
  5: {
    // 6月6日~7月7日
    一白水星: ["木星", "火星"],
    二黒土星: ["火星", "金星"],
    三碧木星: ["木星", "水星"],
    四緑木星: ["木星", "火星"],
    五黄土星: ["火星", "金星"],
    六白金星: ["木星", "水星"],
    七赤金星: ["木星", "火星"],
    八白土星: ["火星", "金星"],
    九紫火星: ["木星", "水星"],
  },
  6: {
    // 7月8日~8月7日
    一白水星: ["木星", "土星"],
    二黒土星: ["土星", "金星"],
    三碧木星: ["火星", "土星"],
    四緑木星: ["木星", "土星"],
    五黄土星: ["土星", "金星"],
    六白金星: ["火星", "土星"],
    七赤金星: ["木星", "土星"],
    八白土星: ["土星", "金星"],
    九紫火星: ["火星", "土星"],
  },
  7: {
    // 8月8日~9月7日
    一白水星: ["土星", "金星"],
    二黒土星: ["土星", "金星"],
    三碧木星: ["土星", "金星"],
    四緑木星: ["土星", "金星"],
    五黄土星: ["土星", "金星"],
    六白金星: ["土星", "金星"],
    七赤金星: ["土星", "金星"],
    八白土星: ["土星", "金星"],
    九紫火星: ["土星", "金星"],
  },
  8: {
    // 9月8日~10月8日
    一白水星: ["金星", "水星"],
    二黒土星: ["木星", "金星"],
    三碧木星: ["金星", "金星"],
    四緑木星: ["金星", "水星"],
    五黄土星: ["木星", "金星"],
    六白金星: ["金星", "金星"],
    七赤金星: ["金星", "水星"],
    八白土星: ["木星", "金星"],
    九紫火星: ["金星", "金星"],
  },
  9: {
    // 10月9日~11月7日
    一白水星: ["火星", "土星"],
    二黒土星: ["木星", "土星"],
    三碧木星: ["木星", "土星"],
    四緑木星: ["火星", "土星"],
    五黄土星: ["木星", "土星"],
    六白金星: ["木星", "土星"],
    七赤金星: ["火星", "土星"],
    八白土星: ["木星", "土星"],
    九紫火星: ["木星", "土星"],
  },
  10: {
    // 11月8日~12月7日
    一白水星: ["水星", "水星"],
    二黒土星: ["水星", "水星"],
    三碧木星: ["水星", "水星"],
    四緑木星: ["水星", "水星"],
    五黄土星: ["水星", "水星"],
    六白金星: ["水星", "水星"],
    七赤金星: ["水星", "水星"],
    八白土星: ["水星", "水星"],
    九紫火星: ["水星", "水星"],
  },
  11: {
    // 12月8日~1月5日
    一白水星: ["金星", "水星"],
    二黒土星: ["水星", "水星"],
    三碧木星: ["水星", "水星"],
    四緑木星: ["金星", "水星"],
    五黄土星: ["水星", "水星"],
    六白金星: ["水星", "水星"],
    七赤金星: ["金星", "水星"],
    八白土星: ["水星", "水星"],
    九紫火星: ["水星", "水星"],
  },
}

// 日付が属する期間のインデックスを取得する関数
export function getDateRangeIndex(month: number, day: number): number {
  for (let i = 0; i < dateRanges.length; i++) {
    const range = dateRanges[i]

    // 12月8日〜1月5日の特殊ケース
    if (i === 11) {
      if ((month === 12 && day >= 8) || (month === 1 && day <= 5)) {
        return i
      }
    }
    // 通常のケース
    else {
      const startMonth = range.start.month
      const startDay = range.start.day
      const endMonth = range.end.month
      const endDay = range.end.day

      if ((month === startMonth && day >= startDay) || (month === endMonth && day <= endDay)) {
        return i
      }
    }
  }

  // デフォルト値（エラー時）
  return 0
}

// 年から天運の星を取得する関数
export function getTenunStarsFromYear(year: number): [FiveElement, FiveElement] {
  // 年から直接天運の星を取得
  if (yearToTenunStars[year]) {
    return yearToTenunStars[year]
  }

  // 年から九星を取得し、九星から天運の星を取得
  const nineStar = yearToNineStar[year] || "五黄土星" // デフォルト値
  return tenunToStars[nineStar] || ["土星", "土星"] // デフォルト値
}

// 画数から五行を導出するマッピング
export function strokeToElement(strokes: number): FiveElement {
  // デバッグ出力
  console.log(`Converting stroke count ${strokes} to element`)

  // 画数の1の位で五行を決定
  const lastDigit = strokes % 10

  // デバッグ出力
  console.log(`Last digit: ${lastDigit}`)

  let element: FiveElement

  if (lastDigit === 1 || lastDigit === 2) element = "木星"
  else if (lastDigit === 3 || lastDigit === 4) element = "火星"
  else if (lastDigit === 5 || lastDigit === 6)
    element = "土星" // 1の位が5または6の場合は土星
  else if (lastDigit === 7 || lastDigit === 8)
    element = "金星" // 1の位が7または8の場合は金星
  else if (lastDigit === 9 || lastDigit === 0)
    element = "水星" // 1の位が9または0の場合は水星
  else element = "土星" // デフォルト（通常はここに来ない）

  // デバッグ出力
  console.log(`Determined element: ${element}`)

  return element
}

// 特定の文字に対する特別な五行マッピング
export const specialCharToElement: Record<string, FiveElement> = {
  // 特定の文字に対する特別なマッピング
  隆: "金星", // 隆は金星として扱う
  靖: "金星", // 靖は金星として扱う
  // 他の特殊なマッピングもここに追加
}

// 画数から五行を導出する改良版マッピング
export function improvedStrokeToElement(char: string, strokes: number): FiveElement {
  // 特定の文字に対する特別なマッピングがあればそれを使用
  if (specialCharToElement[char]) {
    return specialCharToElement[char]
  }

  // 通常のマッピングを使用
  return strokeToElement(strokes)
}
