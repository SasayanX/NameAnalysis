# Google Play Console - サブスクリプション商品追加手順

## 前提条件（既に整っている前提）

✅ **Google Play Developerアカウント** - 既に所有済み  
✅ **マーチャントアカウント** - 既に設定済み  
✅ **Google Play Billingの利用経験** - 別アプリで実装済み

## このアプリ固有の情報

- **パッケージ名**: `com.nameanalysis.ai`
- **アプリ名**: まいにちAI姓名判断 - 完全旧字体対応のAI運命鑑定
- **プラン**:
  - ベーシックプラン: ¥330/月
  - プレミアムプラン: ¥550/月

## ステップ1: このアプリでサブスクリプション商品を作成

### 1.1 商品管理ページへアクセス

1. [Google Play Console](https://play.google.com/console)にログイン
2. **まいにちAI姓名判断** アプリを選択（または新規作成）
3. 左メニューから **収益化** → **商品** → **サブスクリプション** を選択
4. **商品を作成** ボタンをクリック

### 1.2 ベーシックプランの作成

#### 基本情報

1. **商品ID**: `basic-monthly`
   - ⚠️ **重要**: このIDは後で変更できません
   - 小文字、数字、アンダースコアのみ使用可能
   - 例: `basic-monthly`, `basic_plan`, `basic_330`

2. **名前**: `ベーシックプラン`
   - ユーザーに表示される名前

3. **説明**: 
   ```
   日常的に姓名判断を活用したい方に最適なプランです。
   
   【機能】
   • 個人名判断: 1日10回
   • 会社名判断: 1日10回
   • 相性診断: 1日3回
   • 数秘術分析: 1日5回
   • 赤ちゃん名付け: 1日5回
   • 運勢フロー分析: 1日5回
   • PDF出力: 1日10回
   • 履歴保存: 50件まで
   • 詳細な運勢解説
   ```

#### 価格と請求

1. **基本価格**: `¥330`
   - 日本円を選択
   - 月額330円を設定

2. **課金期間**: `1ヶ月`
   - ドロップダウンから「1ヶ月」を選択

3. **基本期間**: `1ヶ月`
   - サブスクリプションの基本期間

4. **無料トライアル**: `なし`（または必要に応じて設定）
   - 例: 7日間の無料トライアルを提供する場合

5. **プロモーション期間**: `なし`（または必要に応じて設定）
   - 初月無料などのプロモーション

#### キャンセルと返金

1. **キャンセル**: `いつでもキャンセル可能`
   - ユーザーはいつでも解約可能

2. **返金ポリシー**: 
   - 既存の返金ポリシーに従う
   - または、個別に設定

#### 保存

1. **保存** ボタンをクリック
2. 商品が作成されます

### 1.3 プレミアムプランの作成

同じ手順で、プレミアムプランを作成：

#### 基本情報

1. **商品ID**: `premium-monthly`
2. **名前**: `プレミアムプラン`
3. **説明**:
   ```
   全機能を無制限で利用したいプロフェッショナル向けプランです。
   
   【機能】
   • 全機能無制限利用
   • 🏆 おなまえ格付けランク（S・A・B・C・D評価）
   • 全国ランキング比較
   • 運勢の強さ・バランス・希少性総合判定
   • 優先サポート
   • カスタムレポート
   • 高度な分析機能
   • 無制限履歴保存
   • 無制限PDF出力
   • 専用ダッシュボード
   ```

#### 価格と請求

1. **基本価格**: `¥550`
2. **課金期間**: `1ヶ月`
3. **基本期間**: `1ヶ月`
4. **無料トライアル**: `なし`（または必要に応じて設定）
5. **プロモーション期間**: `なし`（または必要に応じて設定）

#### 保存

1. **保存** ボタンをクリック
2. 商品が作成されます

## ステップ2: 商品の公開

### 2.1 商品の確認

1. **収益化** → **商品** → **サブスクリプション** に戻る
2. 作成した商品が表示されていることを確認：
   - `basic-monthly`
   - `premium-monthly`

### 2.2 商品の公開

1. 各商品の右側にある **アクティブ** トグルをオンにする
2. 確認ダイアログが表示されたら **有効化** をクリック

⚠️ **注意**: 
- 商品を公開すると、すぐにユーザーが購入可能になります
- アプリ側の実装が完了してから公開することを推奨します

### 2.3 商品IDの確認

公開後、商品IDをメモしておきます：
- `basic-monthly`
- `premium-monthly`

これらのIDは、アプリ側の実装で使用します。

## ステップ3: テストアカウントの設定（既存の設定を確認）

### 3.1 既存のライセンステストアカウントを確認

既に別アプリで設定済みの場合は、そのまま使用可能です。

**新規に設定する場合**:
1. **設定** → **ライセンステスト** を選択
2. **ライセンステストを有効にする** をオン
3. **Gmailアカウント** にテスト用のGoogleアカウントを追加
4. **保存** をクリック

### 3.2 テストアカウントでの動作確認

- テストアカウントでの購入は、実際には課金されません
- 購入フローをテストできます

## ステップ4: 内部テストトラックの設定（既存の設定を確認）

### 4.1 内部テストトラックの確認

既に別アプリで設定済みの場合は、同じ手順でこのアプリにも設定します。

1. **テスト** → **内部テスト** を選択
2. **新しいリリースを作成** をクリック
3. AABファイルをアップロード（`twa/app-release-bundle.aab`）
4. **リリース名** を入力（例: `v6 - Google Play Billing対応`）
5. **リリースノート** を入力
6. **保存** をクリック

### 4.2 テスターの追加

1. **テスター** タブを選択
2. **メールアドレスリスト** にテスト用のGoogleアカウントを追加
3. または、既存の**Googleグループ**を指定

### 4.3 テストリンクの共有

1. **テスト方法** セクションでテストリンクをコピー
2. テスターに共有

## ステップ5: 商品IDの環境変数設定

アプリ側で使用するため、商品IDを環境変数に設定：

```env
# .env.local または本番環境の環境変数
NEXT_PUBLIC_GOOGLE_PLAY_PRODUCT_ID_BASIC=basic-monthly
NEXT_PUBLIC_GOOGLE_PLAY_PRODUCT_ID_PREMIUM=premium-monthly
```

## 重要な注意事項

### 商品IDについて
- ⚠️ **商品IDは一度作成すると変更できません**
- 削除して新規作成する必要があります
- 以下の商品IDを推奨：
  - `basic-monthly`
  - `premium-monthly`

### 既存の購読者への影響
- 価格変更: 既存購読者は旧価格のまま（新規購読者のみ新価格）
- 商品削除: 既存購読者は継続（新規購読は不可）

## トラブルシューティング

### 商品が表示されない
- 商品が有効化されているか確認
- アプリのバージョンが公開されているか確認

### テスト購入ができない
- ライセンステストアカウントが正しく設定されているか確認
- テストアカウントでGoogle Playにログインしているか確認
- アプリが内部テストトラックからインストールされているか確認

## 次のステップ

1. ✅ Google Play Consoleで商品作成（この手順）
2. ⏳ `twa-manifest.json`で`playBilling`を有効化（✅ 完了済み）
3. ⏳ BubblewrapでAABを再ビルド
4. ⏳ アプリ側でDigital Goods APIを実装
5. ⏳ サーバー側での購入検証（既存の実装を参考に）
6. ⏳ テストとデバッグ

## 既存の実装との違い

### 別アプリとの共通点
- Google Play Billing APIの基本仕様
- 購入検証の方法
- サブスクリプション管理のロジック

### このアプリの独自ポイント
- **TWA（Trusted Web Activity）**環境での実装
- **Digital Goods API**を使用（ネイティブAndroid Billing Libraryではない）
- ウェブ技術（TypeScript/React）での実装

## 参考資料

- [Digital Goods API - Chrome Developers](https://developer.chrome.com/docs/android/trusted-web-activity/receive-payments-play-billing)
- [Google Play Billing - サブスクリプション](https://developer.android.com/google/play/billing/subscriptions)
- [Bubblewrap - Play Billing](https://github.com/GoogleChromeLabs/bubblewrap)

