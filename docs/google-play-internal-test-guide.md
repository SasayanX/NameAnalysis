# Google Play Console - 公開前テストガイド

## 概要

Google Play Consoleの「内部テストトラック」または「クローズドテストトラック」を使用して、公開前にアプリをテストする手順です。

## 前提条件

1. Google Play Consoleアカウント
2. アプリの登録が完了している
3. 署名キーが設定されている

## 手順

### ステップ1: AABファイルのビルド

#### 1-1. ビルドコマンドの実行

```bash
cd twa
bubblewrap build --release
```

または、Gradleを直接使用する場合：

```bash
cd twa/app
./gradlew bundleRelease
```

**出力ファイル**: `twa/app/build/outputs/bundle/release/app-release.aab`

#### 1-2. ビルドファイルの確認

ビルドが成功すると、以下のファイルが生成されます：
- `app-release.aab` (Google Play Console用)
- `app-release.apk` (直接インストール用)

### ステップ2: 内部テストトラックの設定

#### 2-1. Google Play Consoleにアクセス

1. [Google Play Console](https://play.google.com/console) にログイン
2. 対象のアプリを選択

#### 2-2. テストトラックを作成

1. 左メニューから **「テスト」** → **「内部テスト」** を選択
2. **「新しいリリースを作成」** をクリック

#### 2-3. AABファイルをアップロード

1. **「アプリバンドルをアップロード」** をクリック
2. `twa/app/build/outputs/bundle/release/app-release.aab` を選択
3. アップロード完了を待つ

#### 2-4. リリースノートを入力（任意）

- 変更内容を日本語で記述
- 例: 「初回リリース。姓名判断機能を追加。」

#### 2-5. テストを保存

1. **「保存」** をクリック
2. **「レビューを開始」** をクリック

### ステップ3: テスターの追加

#### 3-1. テスターリストを作成

1. **「テスター」** タブをクリック
2. **「テスターリストを作成」** をクリック
3. リスト名を入力（例: 「内部テストグループ」）
4. テスターのメールアドレスを追加
   - Gmailアドレスを追加
   - 最大100人まで追加可能

#### 3-2. テストリンクを取得

1. **「テストリンクをコピー」** をクリック
2. リンクをコピー（例: `https://play.google.com/apps/internaltest/xxxxxxxxxx`）

#### 3-3. テスターに共有

テスターに以下の情報を共有：
- テストリンク
- アプリの説明（任意）
- フィードバック方法

### ステップ4: テストの実施

#### 4-1. テスター側の操作

1. テストリンクを開く（Androidデバイスで）
2. **「テスターになる」** をクリック
3. Google Playストアからアプリをインストール

#### 4-2. テスト項目

以下の項目をテストしてください：

- [ ] アプリが正常に起動する
- [ ] 姓名判断が正常に動作する
- [ ] ディープリンクが正しく動作する（`https://seimei.app`からアプリが開く）
- [ ] 決済機能が正常に動作する（テスト環境）
- [ ] 画面レイアウトが正しく表示される
- [ ] パフォーマンスに問題がない

### ステップ5: フィードバックの収集

#### 5-1. テスト結果の報告

テスターから以下の情報を収集：
- バグ報告
- UI/UXの改善提案
- パフォーマンスの問題
- その他のフィードバック

#### 5-2. 問題の修正

問題が見つかった場合：
1. コードを修正
2. AABファイルを再ビルド
3. 新しいバージョンとしてアップロード

### ステップ6: 本番リリースへの準備

#### 6-1. テスト完了の確認

すべてのテストが完了し、重大な問題がないことを確認

#### 6-2. 本番リリースへの移行

1. **「本番環境」** → **「リリースを作成」** をクリック
2. テスト済みのAABファイルをアップロード
3. リリースノートを入力
4. **「レビューを開始」** をクリック

## トラブルシューティング

### 問題1: AABファイルがアップロードできない

**原因**: ファイルサイズが大きすぎる、または署名エラー

**解決方法**:
1. ファイルサイズを確認（100MB以下であること）
2. 署名キーが正しく設定されているか確認
3. ビルドを再実行

### 問題2: テスターがアプリをインストールできない

**原因**: テストリンクが正しく共有されていない、またはテスターが追加されていない

**解決方法**:
1. テストリンクが正しいか確認
2. テスターのメールアドレスが正しいか確認
3. テスターが「テスターになる」をクリックしているか確認

### 問題3: ディープリンクが動作しない

**原因**: `assetlinks.json`が正しく配信されていない

**解決方法**:
1. `https://seimei.app/.well-known/assetlinks.json` にアクセスして確認
2. SHA-256フィンガープリントが正しいか確認
3. アプリを再インストール

## 参考情報

### 内部テスト vs クローズドテスト vs オープンテスト

| 項目 | 内部テスト | クローズドテスト | オープンテスト |
|------|-----------|----------------|--------------|
| テスター数 | 最大100人 | 最大20,000人 | 無制限 |
| 審査 | 不要 | 不要 | 必要 |
| 公開期間 | 即座 | 即座 | 審査後 |
| 用途 | 初期テスト | 本格テスト | ベータ版 |

### バージョンコードの管理

AABファイルをアップロードする際は、バージョンコードを必ず増やす必要があります。

**確認方法**:
- `twa/app/build.gradle` の `versionCode` を確認
- 新しいビルドでは必ず `versionCode` を増やす

**例**:
```gradle
versionCode 1  // 初回リリース
versionCode 2  // 2回目のリリース
versionCode 3  // 3回目のリリース
```

## チェックリスト

### ビルド前

- [ ] コードの変更をコミット・プッシュ
- [ ] 本番環境（`seimei.app`）にデプロイ済み
- [ ] `assetlinks.json`が正しく配信されている
- [ ] バージョンコードを更新

### ビルド時

- [ ] `bubblewrap build --release` を実行
- [ ] ビルドエラーがないことを確認
- [ ] AABファイルが生成されていることを確認

### アップロード時

- [ ] Google Play Consoleにログイン
- [ ] 内部テストトラックを選択
- [ ] AABファイルをアップロード
- [ ] リリースノートを入力
- [ ] レビューを開始

### テスト時

- [ ] テスターリストを作成
- [ ] テストリンクを共有
- [ ] テスターがアプリをインストールできることを確認
- [ ] テスト項目を確認
- [ ] フィードバックを収集

### 本番リリース前

- [ ] すべてのテストが完了
- [ ] 重大な問題がないことを確認
- [ ] リリースノートを作成
- [ ] 本番リリースを開始

