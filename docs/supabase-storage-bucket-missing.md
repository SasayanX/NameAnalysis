# バケット未作成時の挙動

## バケットを作成しない場合

### 開発環境（localhost）

1. **Storageアップロードを試みる**
   - エラー: `Bucket not found` または `The resource was not found`

2. **フォールバック処理**
   - `public/generated/cards/` ディレクトリに保存を試みる
   - 保存は成功するが、**再デプロイ時にファイルが消える可能性がある**

3. **結果**
   - カード発行は成功する（一時的に）
   - 共有URLは動作するが、**再デプロイ後は404エラーになる**
   - 本番環境では動作しない

### 本番環境（Netlify/Vercel）

1. **Storageアップロードを試みる**
   - エラー: `Bucket not found`

2. **フォールバック処理**
   - `public/generated/cards/` への保存を試みる
   - **サーバーレス環境ではファイルシステムへの書き込みができないため失敗**

3. **結果**
   - **カード発行が失敗する**
   - エラーメッセージ: `画像の保存に失敗しました。Supabase Storageの設定を確認してください。`
   - ユーザーにはカードが発行されない

## エラーメッセージの例

### Storageアップロードエラー
```
❌ Storageアップロードエラー: {
  message: "The resource was not found",
  statusCode: 404,
  error: "Bucket 'rare-cards' not found"
}
```

### 最終的なエラー
```
画像の保存に失敗しました。Supabase Storageの設定を確認してください。
```

## 推奨される対応

### ✅ バケットを作成する（推奨）

1. Supabaseダッシュボードで `rare-cards` バケットを作成
2. 公開バケットに設定
3. Storageポリシーを設定

詳細は `docs/supabase-storage-setup.md` を参照

### ⚠️ 一時的な対応（開発環境のみ）

開発環境でテストする場合のみ：
- `public/generated/cards/` ディレクトリを作成
- 一時的に動作するが、本番環境では動作しない

## まとめ

| 環境 | バケットなし | バケットあり |
|------|------------|------------|
| **開発環境** | ⚠️ ローカル保存（一時的） | ✅ Storage保存（永続的） |
| **本番環境** | ❌ エラー（発行失敗） | ✅ Storage保存（永続的） |

**結論**: 本番環境で使用する場合は、必ずバケットを作成してください。

