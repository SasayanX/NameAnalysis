# ムームーメール設定ガイド（seimei.app）

## 現在の状況

- ✅ ムームーメールを契約済み
- ✅ ムームーDNSでALIASレコードを設定済み（Webサイト用）
- ⚠️ MXレコードが未設定（メール機能が使用不可）

## 設定手順

### ステップ1: ムームーメールの設定情報を確認

1. **ムームードメインの管理画面にログイン**
   - https://muumuu-domain.com/

2. **ムームーメールの設定画面を開く**
   - ドメイン管理 → `seimei.app` を選択
   - 「ムームーメール」または「メール設定」を開く

3. **MXレコードの設定情報を確認**
   - ムームーメールの管理画面で、設定すべきMXレコードが表示されます
   - 通常は以下のような形式です：
     ```
     優先度: 10
     値: mx1.muumuu-mail.com
     
     優先度: 20
     値: mx2.muumuu-mail.com
     ```
   - または、`muumuu-domain.com` をドメインとする形式の場合もあります

### ステップ2: ムームーDNSでMXレコードを設定

**重要**: ネームサーバーがムームーDNSを指している場合、ムームーDNS側で設定してください。

1. **DNS設定を開く**
   - ムームードメインの管理画面 → DNS設定

2. **MXレコードを追加**

   **レコード1（優先度が最も高いもの）**:
   - **レコードタイプ**: `MX`
   - **サブドメイン/ホスト名**: `@` または空白
   - **優先度**: `10`（ムームーメールの管理画面で指定された値）
   - **値（指す値）**: `mx1.muumuu-mail.com`（ムームーメールの管理画面で指定された値）
   - **TTL**: `3600`

   **レコード2（バックアップ用）**:
   - **レコードタイプ**: `MX`
   - **サブドメイン/ホスト名**: `@` または空白
   - **優先度**: `20`（ムームーメールの管理画面で指定された値）
   - **値（指す値）**: `mx2.muumuu-mail.com`（ムームーメールの管理画面で指定された値）
   - **TTL**: `3600`

   ⚠️ **注意**: 正確なMXレコードの値は、ムームーメールの管理画面で確認してください。

3. **保存**
   - 設定を保存

### ステップ3: SPFレコードを設定（オプション、推奨）

メールの送信元を認証するためのSPFレコードを設定します。

- **レコードタイプ**: `TXT`
- **サブドメイン/ホスト名**: `@` または空白
- **値**: `v=spf1 include:muumuu-mail.com ~all`
  - ⚠️ **注意**: 正確なSPFレコードの値は、ムームーメールのドキュメントで確認してください
  - 既存のSPFレコードがある場合（例: Resend用）、統合する必要があります：
    ```
    v=spf1 include:resend.com include:muumuu-mail.com ~all
    ```
- **TTL**: `3600`

### ステップ4: DKIMレコードを設定（オプション、推奨）

メールの署名認証のためのDKIMレコードを設定します。

- **レコードタイプ**: `TXT`
- **サブドメイン/ホスト名**: ムームーメールの管理画面で指定された値（例: `_dmarc`、`default._domainkey` など）
- **値**: ムームーメールの管理画面で提供される長い文字列
- **TTL**: `3600`

### ステップ5: DMARCレコードを設定（オプション）

メール認証ポリシーのためのDMARCレコードを設定します。

- **レコードタイプ**: `TXT`
- **サブドメイン/ホスト名**: `_dmarc`
- **値**: `v=DMARC1; p=none; rua=mailto:your-email@example.com`
  - `your-email@example.com` の部分を、DMARCレポートを受信したいメールアドレスに変更
- **TTL**: `3600`

### ステップ6: DNS伝播の確認

DNS設定が反映されるまで、数分〜最大48時間かかります。

**確認方法**:
```bash
# MXレコードの確認
nslookup -type=MX seimei.app

# SPFレコードの確認
nslookup -type=TXT seimei.app
```

**期待される結果**:
```
seimei.app      MX preference = 10, mail exchanger = mx1.muumuu-mail.com
seimei.app      MX preference = 20, mail exchanger = mx2.muumuu-mail.com
```

### ステップ7: メールの動作確認

1. **メールアカウントの作成**
   - ムームーメールの管理画面で、メールアカウントを作成
   - 例: `info@seimei.app`、`contact@seimei.app` など

2. **メールの送受信テスト**
   - 外部のメールアドレスから `info@seimei.app` にテストメールを送信
   - 受信できることを確認
   - `info@seimei.app` から外部にメールを送信
   - 送信できることを確認

## 既存のDNSレコードとの統合

### Resend（お問い合わせフォーム用）と併用する場合

既にResend用のSPFレコードが設定されている場合、統合が必要です：

**既存のSPFレコード**:
```
v=spf1 include:resend.com ~all
```

**統合後のSPFレコード**:
```
v=spf1 include:resend.com include:muumuu-mail.com ~all
```

**設定方法**:
1. 既存のSPFレコードを削除
2. 統合後のSPFレコードを追加

## トラブルシューティング

### 問題1: MXレコードが反映されない

**確認事項**:
1. ネームサーバーがムームーDNSを指しているか確認
   ```bash
   nslookup -type=NS seimei.app
   ```
2. ムームーDNS側でMXレコードが正しく設定されているか確認
3. DNS伝播を待つ（最大48時間）

**解決方法**:
- ムームーDNSの管理画面でMXレコードを再確認
- レコードの値が正確か確認（一字一句正確に）

### 問題2: メールが受信できない

**確認事項**:
1. MXレコードが正しく設定されているか
2. メールアカウントが作成されているか
3. メールボックスの容量が満杯でないか

**解決方法**:
- ムームーメールの管理画面で、メールアカウントの状態を確認
- ムームーメールのサポートに問い合わせ

### 問題3: メールが送信できない

**確認事項**:
1. SPFレコードが正しく設定されているか
2. メールアカウントの設定（SMTP設定など）が正しいか

**解決方法**:
- SPFレコードを確認
- ムームーメールの管理画面で、送信設定を確認

### 問題4: 既存のSPFレコードと競合

**状況**: Resend用のSPFレコードとムームーメール用のSPFレコードが競合

**解決方法**:
- 1つのSPFレコードに統合：
  ```
  v=spf1 include:resend.com include:muumuu-mail.com ~all
  ```

## 参考リンク

- [ムームードメイン: ムームーメール設定ガイド](https://muumuu-domain.com/guide/mail/)
- [ムームーメール: ヘルプページ](https://muumuu-domain.com/support/)
- [DNS伝播チェッカー](https://dnschecker.org/)

## まとめ

1. ✅ ムームーメールの管理画面でMXレコードの設定情報を確認
2. ✅ ムームーDNS側でMXレコードを設定
3. ✅ SPF、DKIM、DMARCレコードを設定（推奨）
4. ✅ DNS伝播を待つ（数時間）
5. ✅ メールの送受信テスト

これで、`info@seimei.app` などのドメインメールが使用できるようになります。


