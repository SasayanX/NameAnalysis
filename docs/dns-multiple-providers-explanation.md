# DNSレコードを複数の場所に設定した場合の動作

## 結論

**DNSレコードをムームードメインとNetlifyの両方に設定すると、権威DNSサーバー（ネームサーバー）が指している場所のレコードのみが有効になります。もう一方のレコードは無視されます。**

## DNSの基本動作

### 権威DNSサーバーとは

ドメインのDNS設定は、**権威DNSサーバー（ネームサーバー）**で管理されています。このサーバーは、ドメインの**NSレコード**で指定されています。

### 確認方法

ドメインの権威DNSサーバーを確認するには：

```bash
# コマンドラインで確認
nslookup -type=NS seimei.app

# またはオンラインツール
# https://mxtoolbox.com/SuperTool.aspx
```

通常、以下のような結果が返されます：

```
seimei.app  nameserver = ns1.muumuu-domain.com
seimei.app  nameserver = ns2.muumuu-domain.com
```

または

```
seimei.app  nameserver = dns1.p01.nsone.net
seimei.app  nameserver = dns2.p01.nsone.net
```

## 両方に設定した場合の動作

### ケース1: ムームードメインが権威DNSサーバー

**状況**:
- NSレコードがムームードメインを指している（例：`ns1.muumuu-domain.com`）
- ムームードメインにResendのDNSレコードを設定
- Netlifyにも同じレコードを設定

**結果**:
- ✅ **ムームードメインのレコードが有効**
- ❌ Netlifyのレコードは無視される
- Netlifyのレコードは参照されないため、設定しても意味がない

### ケース2: Netlifyが権威DNSサーバー

**状況**:
- NSレコードがNetlifyを指している（例：`dns1.p01.nsone.net`）
- NetlifyにResendのDNSレコードを設定
- ムームードメインにも同じレコードを設定

**結果**:
- ✅ **Netlifyのレコードが有効**
- ❌ ムームードメインのレコードは無視される
- ムームードメインのレコードは参照されないため、設定しても意味がない

## 確認方法

### 1. 権威DNSサーバーを確認

```bash
nslookup -type=NS seimei.app
```

または、以下のオンラインツールを使用：
- https://mxtoolbox.com/SuperTool.aspx
- https://www.whatsmydns.net/

### 2. 有効なDNSレコードを確認

権威DNSサーバーで設定されているレコードのみが有効です。

```bash
# ResendのSPFレコードを確認
nslookup -type=TXT seimei.app

# ResendのDKIMレコードを確認（例）
nslookup -type=TXT default._domainkey.seimei.app
```

## 推奨される設定方法

### 方法1: ムームードメインで管理（推奨）

**条件**: NSレコードがムームードメインを指している場合

**手順**:
1. ムームードメインのDNS設定にResendのレコードを追加
2. NetlifyのDNS設定には設定しない（または削除）
3. DNS伝播を待つ（数分〜数時間）

**メリット**:
- ドメイン管理が一元化される
- 他のDNSレコード（メール等）も同じ場所で管理できる

### 方法2: Netlifyで管理

**条件**: NSレコードをNetlifyに変更している場合

**手順**:
1. ムームードメインのDNS設定で、NSレコードをNetlifyのネームサーバーに変更
2. NetlifyのDNS設定にResendのレコードを追加
3. ムームードメインのDNS設定からは削除（または無視）

**メリット**:
- Netlifyと連携しやすい
- ホスティングとDNS管理を統合

**デメリット**:
- ムームードメインで設定した他のDNSレコードも移行が必要

## よくある間違い

### ❌ 間違い1: 両方に設定してしまう

```
ムームードメイン: SPFレコードを設定
Netlify: 同じSPFレコードを設定
```

**結果**: 権威DNSサーバー側のレコードのみが有効。もう一方は無視される。

### ❌ 間違い2: どちらが有効か分からなくなる

両方に設定すると、どの設定が有効か判断できなくなり、トラブルシューティングが困難になります。

### ✅ 正しい方法

**権威DNSサーバーを確認 → その場所にのみ設定**

## 現在の状況の確認方法

### ステップ1: 権威DNSサーバーを確認

```bash
nslookup -type=NS seimei.app
```

### ステップ2: 有効なDNSレコードを確認

```bash
# 現在有効なSPFレコードを確認
nslookup -type=TXT seimei.app
```

### ステップ3: 設定場所を決定

- **ムームードメインが権威DNSサーバー** → ムームードメインに設定
- **Netlifyが権威DNSサーバー** → Netlifyに設定

## トラブルシューティング

### 問題: どちらに設定すればいいか分からない

**解決方法**:
1. 権威DNSサーバーを確認（`nslookup -type=NS seimei.app`）
2. 権威DNSサーバー側に設定
3. もう一方の設定は削除（または無視）

### 問題: 設定したのに反映されない

**確認事項**:
1. 権威DNSサーバー側に設定しているか
2. DNS伝播が完了しているか（数時間待つ）
3. レコードの値が正確か（一字一句正確にコピー）

## まとめ

- **DNSレコードは権威DNSサーバー（ネームサーバー）側にのみ設定**
- **両方に設定しても、権威DNSサーバー側のレコードのみが有効**
- **もう一方のレコードは無視されるため、設定する必要はない**
- **混乱を避けるため、権威DNSサーバー側にのみ設定することを推奨**



