# Google Play Console - 初回購入許可設定

## エラーメッセージ

```
デベロッパーが初回購入を許可していません
```

このエラーは、Google Play Consoleでサブスクリプション商品の「初回購入を許可する」設定が無効になっている場合に表示されます。

## 解決方法（2025年最新版）

### ステップ1: 商品がアクティブになっているか確認 ⭐ 最重要

1. [Google Play Console](https://play.google.com/console)にログイン
2. **まいにちAI姓名判断** アプリを選択
3. **収益化** → **商品** → **サブスクリプション** を選択
4. 商品の状態を確認：
   - **「アクティブ」** になっている必要があります
   - **「下書き」** の場合は、まずアクティブ化が必要です

### ステップ2: ライセンステストの設定を確認 ⭐ 重要

1. **設定** → **ライセンステスト** を選択
2. **ライセンステストを有効にする** がオンになっているか確認
3. **Gmailアカウント** にテスト用のGoogleアカウントが追加されているか確認
4. テスト用のGoogleアカウントを追加（まだ追加していない場合）
5. **保存** をクリック

**重要**: ライセンステストが有効になっていないと、購入テストができません。

### ステップ3: サブスクリプション商品ページに移動

1. 左メニューから **収益化** → **商品** → **サブスクリプション** を選択
2. 作成済みのサブスクリプション商品を選択（例: `basic_monthly` または `premium_monthly`）

### ステップ4: 初回購入許可設定を有効化

**方法1: 商品編集ページで確認**

1. 商品の詳細ページ（編集ページ）を開く
2. ページ全体をスクロールして、以下のセクションを確認：
   - **「基本設定」** セクション
   - **「価格と請求」** セクション（存在する場合）
   - **「詳細設定」** セクション
   - **「その他の設定」** セクション
3. **「初回購入を許可する」** または **「Allow first-time purchase」** のチェックボックスを探す
4. チェックボックスを**有効にする**
5. **「保存」** をクリック

**方法2: 商品作成時に設定**

1. **「商品を作成」** ボタンをクリック
2. 商品作成ウィザードで、**「基本設定」** または **「価格設定」** のステップで確認
3. **「初回購入を許可する」** のチェックボックスを有効にする
4. 商品作成を完了

**方法3: 商品一覧から直接設定**

1. **収益化** → **商品** → **サブスクリプション** の一覧ページ
2. 商品の右側にある **「アクティブ」** トグルを確認
3. トグルの近くに **「編集」** または **「設定」** ボタンがある場合、そこから設定可能

### ステップ4: 商品をアクティブ化

1. 商品の詳細ページの上部で、**「アクティブ」** または **「公開」** ボタンをクリック
2. 確認ダイアログで **「アクティブにする」** をクリック

### ステップ5: 変更を確認

1. 商品の状態が **「アクティブ」** になっていることを確認
2. **「初回購入を許可する」** が有効になっていることを確認

## 注意事項

### 内部テストでの確認

内部テストトラックでアップロードしたアプリでも、商品がアクティブになっていないと購入できません。

### 商品の状態

- **下書き**: 商品は作成されているが、まだアクティブではない
- **アクティブ**: 商品が有効化され、購入可能
- **一時停止**: 商品が一時的に無効化されている

### 初回購入許可の設定場所

Google Play ConsoleのUIは更新される可能性があるため、以下の場所を確認してください：

1. **商品編集ページの上部**
   - 商品名の下に設定がある場合

2. **商品編集ページの「基本設定」セクション**
   - 商品ID、名前、説明の近く

3. **商品編集ページの「価格と請求」セクション**
   - 価格設定の近く（存在する場合）

4. **商品編集ページの「詳細設定」セクション**
   - その他の設定項目と一緒に

5. **商品作成ウィザード内**
   - 商品作成時に設定する必要がある場合

6. **商品一覧ページ**
   - 商品の右側にある「アクティブ」トグルの近く

## トラブルシューティング

### 設定が見つからない場合

1. 商品が正しく作成されているか確認
2. 商品の状態が「下書き」の場合は、まずアクティブ化が必要
3. マーチャントアカウントが正しく設定されているか確認

### 設定してもエラーが出る場合

1. アプリを再起動
2. Google Playストアのキャッシュをクリア
3. 数分待ってから再度試す（設定の反映に時間がかかる場合がある）

### 内部テストでの確認

内部テストトラックでアップロードしたアプリでも、商品がアクティブになっていないと購入できません。必ず商品をアクティブ化してください。

## 確認方法

### アプリ内で確認

1. TWAアプリを起動
2. `/pricing`ページにアクセス
3. Google Play Billingボタンが表示されているか確認
4. ボタンをクリックして購入フローを開始
5. エラーが出ないことを確認

### Google Play Consoleで確認

1. **収益化** → **商品** → **サブスクリプション**
2. 商品の状態が **「アクティブ」** になっているか確認
3. **「初回購入を許可する」** が有効になっているか確認

